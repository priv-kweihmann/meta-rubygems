From e81ee8144b73872826c1cfed67661dd84c28cbca Mon Sep 17 00:00:00 2001
From: Konrad Weihmann <kweihmann@outlook.com>
Date: Thu, 11 Feb 2021 13:50:01 +0100
Subject: [PATCH] Replace URI.escape with CGI.escape

as URI.escape has been removed with ruby 3.0.0

Upstream-Status: Pending
Signed-off-by: Konrad Weihmann <kweihmann@outlook.com>
---
 lib/puppet/util.rb | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/lib/puppet/util.rb b/lib/puppet/util.rb
index db1aa64..ccc9d93 100644
--- a/lib/puppet/util.rb
+++ b/lib/puppet/util.rb
@@ -4,6 +4,7 @@ require 'English'
 require 'puppet/error'
 require 'puppet/util/execution_stub'
 require 'uri'
+require 'cgi'
 require 'pathname'
 require 'ostruct'
 require 'puppet/util/platform'
@@ -473,7 +474,7 @@ module Util
     orig_verbose = $VERBOSE
     $VERBOSE = nil unless Puppet::Util::Platform.jruby?
     begin
-      encoded += URI.escape(parts[:path]) unless parts[:path].nil?
+      encoded = CGI.escape(parts[:path]).gsub('%2F','/').gsub('%3A', ':') unless parts[:path].nil?
     ensure
       $VERBOSE = orig_verbose unless Puppet::Util::Platform.jruby?
     end
-- 
2.25.1

